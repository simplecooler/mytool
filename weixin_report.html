<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <title>数据报表</title>
    <link href="/static/bootstrap-3.3.2/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/static/css/animate.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/static/css/weui.min.css">
</head>
<style>
    .page {
        width: 100%;
        height: 100%;
        text-align: center;
    }

    .content {
        padding:10px;
    }

    .title {
        width:80%;
        margin: 0 auto;
        padding:3px 0;
        background-color: #6673FE;
        border-radius: 5px;
        color: #FFFFFF;
        font-weight: bold;
    }

    .table {
        margin-bottom: 0;
    }

    .total_table {
        margin-top: 20px;
        border-radius: 5px;
    }

    .top_table {
        margin-top: 20px;
    }

    .top_ddos_table {
        margin-top: 10px;
        margin-bottom: 20px;
    }

    .pie-chart {
        height: 230px;
        width: 100%;
        margin-top: 10px;
    }

    .pie-font {
        font-size: 12px;
    }

    .foot_button {
        position: fixed;
        bottom: 0;
    }

    .foot_button td {
        background-color: #ffffff;
    }

    .table>tbody>tr>td {
        vertical-align: middle;
    }

    .select-block {
        position: fixed;
        left:1px;
        width: 100%;
    }

    .select-table {
        width: 25%;
        display: none;
        animation-duration: 0.1s;
    }

    .select-table td {
        background-color: #ffffff;
    }

    .foot_btn {
        font-size: 13px;
    }

    .loading{
        width:60px;
        height:15px;
        margin-top:35%;
    }
</style>
<body>
<div class="page">
    <!--Loading-->
    <div id="toast">
        <div class="weui_mask_transparent"></div>
        <div class="weui_toast">
            <img class="loading" src="/static/img/three-dots.svg" alt="">
            <p class="weui_toast_content">请稍后</p>
        </div>
    </div>
    <!--内容-->
    <div class="content" id="content_render"></div>
    <!--按钮弹出-->
    <div class="container-fluid select-block">
        <div class="row">
            <table class="table table-bordered col-xs-3 select-table animated slideInUp" id="access">
                <tbody>
                <tr><td action="btn_today">今天</td></tr>
                <tr><td action="btn_yesterday">昨天</td></tr>
                <tr><td action="btn_seven">7天</td></tr>
                </tbody>
            </table>

            <table class="table table-bordered col-xs-3 col-xs-offset-3 select-table animated slideInUp" id="safe">
                <tbody>
                <tr><td action="btn_today">今天</td></tr>
                <tr><td action="btn_yesterday">昨天</td></tr>
                <tr><td action="btn_seven">7天</td></tr>
                </tbody>
            </table>

            <table class="table table-bordered col-xs-3 col-xs-offset-6 select-table animated slideInUp" id="speed">
                <tbody>
                <tr><td action="btn_today">今天</td></tr>
                <tr><td action="btn_yesterday">昨天</td></tr>
                <tr><td action="btn_seven">7天</td></tr>
                </tbody>
            </table>

            <table class="table table-bordered col-xs-3 col-xs-offset-9 select-table animated slideInUp" id="ddos">
                <tbody>
                <tr><td action="btn_today">今天</td></tr>
                <tr><td action="btn_yesterday">昨天</td></tr>
                <tr><td action="btn_seven">7天</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <!--底部按钮-->
    <table class="table table-bordered foot_button">
        <tbody>
        <tr>
            <td class="foot_btn col-xs-3" id="access_btn"><span class="glyphicon glyphicon-chevron-up"></span><br/>访问情况</td>
            <td class="foot_btn col-xs-3" id="safe_btn"><span class="glyphicon glyphicon-chevron-up"></span><br/>安全情况</td>
            <td class="foot_btn col-xs-3" id="speed_btn"><span class="glyphicon glyphicon-chevron-up"></span><br/>加速情况</td>
            <td class="foot_btn col-xs-3" id="ddos_btn"><span class="glyphicon glyphicon-chevron-up"></span><br/>DDoS攻击</td>
        </tr>
        </tbody>
    </table>
</div>
</body>
<!--访问情况模板-->
<script type="text/template" id="access_template">
    <div class="title">{{title}}</div>
    <table class="table table-bordered total_table">
        <thead>
        <tr>
            <td class="col-xs-6">总请求次数</td>
            <td class="col-xs-6">总流量</td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="col-xs-6">{{total_req_count}} 次</td>
            <td class="col-xs-6">{{total_req_flow}} MB</td>
        </tr>
        </tbody>
    </table>

    <table class="table table-bordered top_table">
        <thead>
        <tr>
            <td class="col-xs-4">访问IP前五</td>
            <td class="col-xs-4">归属地</td>
            <td class="col-xs-4">次数</td>
        </tr>
        </thead>
        <tbody>
        {{#top5_arr}}
        <tr>
            <td>{{key}}</td>
            <td>{{province}}</td>
            <td>{{doc_count}} 次</td>
        </tr>
        {{/top5_arr}}
        </tbody>
    </table>
</script>
<!--安全情况模板-->
<script type="text/template" id="safe_template">
    <div class="title">{{title}}</div>
    <table class="table table-bordered total_table">
        <thead>
        <tr>
            <td class="col-xs-6">CC攻击总数</td>
            <td class="col-xs-6">WAF攻击总数</td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="col-xs-6">{{total_cc_count}} 次</td>
            <td class="col-xs-6">{{total_waf_count}} 次</td>
        </tr>
        </tbody>
    </table>

    <table class="table table-bordered top_table">
        <thead>
        <tr>
            <td class="col-xs-4">CC攻击IP前五</td>
            <td class="col-xs-4">归属地</td>
            <td class="col-xs-4">次数</td>
        </tr>
        </thead>
        <tbody>
        {{#top5_cc_arr}}
        <tr>
            <td>{{remote_ip}}</td>
            <td>{{city}}</td>
            <td>{{totalNums}} 次</td>
        </tr>
        {{/top5_cc_arr}}
        </tbody>
    </table>

    <table class="table table-bordered top_table">
        <thead>
        <tr>
            <td class="col-xs-4">WAF攻击IP前五</td>
            <td class="col-xs-4">归属地</td>
            <td class="col-xs-4">次数</td>
        </tr>
        </thead>
        <tbody>
        {{#top5_waf_arr}}
        <tr>
            <td>{{ip}}</td>
            <td>{{location}}</td>
            <td>{{count}} 次</td>
        </tr>
        {{/top5_waf_arr}}
        </tbody>
    </table>
</script>
<!--加速情况模板-->
<script type="text/template" id="speed_template">
    <div class="title">{{title}}</div>
    <div class="pie-chart" id="pie_chart_flow"></div>
    <p class="pie-font">总流量：{{total_flow}} MB 加速流量：{{save_flow}} MB 加速比例：{{percent_flow}} %</p>
    <div class="pie-chart" id="pie_chart_req"></div>
    <p class="pie-font">总请求：{{total_req}} 次 加速请求：{{save_req}} MB 加速比例：{{percent_req}} %</p>
</script>
<!--DDoS攻击模板-->
<script type="text/template" id="ddos_template">
    <div class="title">{{title}}</div>
    <table class="table table-bordered top_ddos_table top_table">
        <thead>
        <tr>
            <td class="col-xs-6">带宽峰值</td>
            <td class="col-xs-6">时间</td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="col-xs-6">{{top_flow}} G</td>
            <td class="col-xs-6">{{time}}</td>
        </tr>
        </tbody>
    </table>

    <table class="table table-bordered top_ddos_table">
        <thead>
        <tr>攻击类型前六</tr>
        </thead>
        <tbody>
        {{#top6_type}}
        <tr>
            <td>{{one}}</td>
            <td>{{two}}</td>
            <td>{{three}}</td>
        </tr>
        <tr>
            <td>{{four}}</td>
            <td>{{five}}</td>
            <td>{{six}}</td>
        </tr>
        {{/top6_type}}
        </tbody>
    </table>

    <table class="table table-bordered top_ddos_table">
        <thead>
        <tr>攻击IP前十</tr>
        </thead>
        <tbody>
        {{#top10_ip}}
        <tr>
            <td>{{first}}</td>
            <td>{{second}}</td>
        </tr>
        {{/top10_ip}}
        </tbody>
    </table>
</script>

<script src="/static/js/jquery/jquery-2.1.4.min.js"></script>
<script src="/static/js/mustache.js" type="text/javascript"></script>
<script src="/static/echarts-2.2.4/dist/echarts.js" type="text/javascript"></script>
<script>
    $(document).ready(function(){

        //得到域名列表传入参数方法
        var GetQueryString = function(name){
            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if(r!=null)return  unescape(r[2]); return null;
        };

        //定义域名列表页面传入参数
        var domain = GetQueryString("domain");
        var userid = GetQueryString("userID");
        var id = GetQueryString("id");

        //页面初始定位
        $('.foot_button td').css('height',window.innerHeight * 0.08);
        $('.select-block').css('bottom',$('.foot_button').height());
        $('.page').css('padding-bottom',$('.foot_button').height() + 13);

        //按钮方法调用
        btn_show('#access','#safe','#speed','#ddos');
        btn_show('#safe','#access','#speed','#ddos');
        btn_show('#speed','#safe','#access','#ddos');
        btn_show('#ddos','#safe','#speed','#access');

        //点击按钮其他地方弹出窗口消失
        $(document).on('click',function(){
            $('#access').css('display','none');
            $('#safe').css('display','none');
            $('#speed').css('display','none');
            $('#ddos').css('display','none');
        });

        //进入页面立即渲染今日访问报表
        $.ajax({
            type:"POST",
            data:{domain:domain,node:"",size:5,start_time:getTime('end'),end_time:getTime('now')},
            url:'/weixin/mobile/ngAccessWX',
            dataType:'json',
            success:function(data){
                $('#toast').css('display','none');
                var today_data = {
                    title: "今天访问概述",
                    total_req_count:data.data.sum_times,
                    total_req_flow:data.data.sum_flaw,
                    top5_arr:data.data.ip_lists
                };
                var rendered = Mustache.to_html($('#access_template').html(), today_data);
                $('#content_render').html(rendered);
            }
        });

        //访问情况接口调用和模板渲染
        $('#access td').on('click',function(e){
            var current = $(e.currentTarget);
            if(current.attr("action") === "btn_today") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{domain:domain,node:"",size:5,start_time:getTime('end'),end_time:getTime('now')},
                    url:'/weixin/mobile/ngAccessWX',
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var today_data = {
                            title: "今天访问概述",
                            total_req_count:data.data.sum_times,
                            total_req_flow:data.data.sum_flaw,
                            top5_arr:data.data.ip_lists
                        };
                        var rendered = Mustache.to_html($('#access_template').html(), today_data);
                        $('#content_render').html(rendered);
                    }
                });
            }else if(current.attr("action") === "btn_yesterday") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{domain:domain,node:"",size:5,start_time:getTime('yesterday'),end_time:getTime('end')},
                    url:'/weixin/mobile/ngAccessWX',
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var yesterday_data = {
                            title: "昨天访问概述",
                            total_req_count:data.data.sum_times,
                            total_req_flow:data.data.sum_flaw,
                            top5_arr:data.data.ip_lists
                        };
                        var rendered = Mustache.to_html($('#access_template').html(), yesterday_data);
                        $('#content_render').html(rendered);
                    }
                });
            }else if(current.attr("action") === "btn_seven") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{domain:domain,node:"",size:5,start_time:getTime('sevenStart'),end_time:getTime('now')},
                    url:'/weixin/mobile/ngAccessWX',
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var seven_data = {
                            title: "7天访问概述",
                            total_req_count:data.data.sum_times,
                            total_req_flow:data.data.sum_flaw,
                            top5_arr:data.data.ip_lists
                        };
                        var rendered = Mustache.to_html($('#access_template').html(), seven_data);
                        $('#content_render').html(rendered);
                    }
                });
            }
        });

        //安全情况接口调用和模板渲染
        $('#safe td').on('click',function(e){
            var current = $(e.currentTarget);
            if(current.attr("action") === "btn_today") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:1},
                    url:'/dashboard/reportWX/'+ id,
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var safe_today = {
                            title: "今天安全情况",
                            total_cc_count:data.res_cc.totalCc,
                            total_waf_count:data.res_waf.totalCcWaf,
                            top5_cc_arr:data.ccTop,
                            top5_waf_arr:data.topWafIp
                        };
                        var rendered = Mustache.to_html($('#safe_template').html(), safe_today);
                        $('#content_render').html(rendered);
                    }
                });
            }else if(current.attr("action") === "btn_yesterday") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-1},
                    url:'/dashboard/reportWX/'+ id,
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var safe_yesterday = {
                            title: "昨天安全情况",
                            total_cc_count:data.res_cc.totalCc,
                            total_waf_count:data.res_waf.totalCcWaf,
                            top5_cc_arr:data.ccTop,
                            top5_waf_arr:data.topWafIp
                        };
                        var rendered = Mustache.to_html($('#safe_template').html(), safe_yesterday);
                        $('#content_render').html(rendered);
                    }
                });
            }else if(current.attr("action") === "btn_seven") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-3},
                    url:'/dashboard/reportWX/'+ id,
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var safe_seven = {
                            title: "7天安全情况",
                            total_cc_count:data.res_cc.totalCc,
                            total_waf_count:data.res_waf.totalCcWaf,
                            top5_cc_arr:data.ccTop,
                            top5_waf_arr:data.topWafIp
                        };
                        var rendered = Mustache.to_html($('#safe_template').html(), safe_seven);
                        $('#content_render').html(rendered);
                    }
                });
            }
        });

        //加速情况接口调用和模板渲染
        $('#speed td').on('click',function(e){
            var current = $(e.currentTarget);
            if(current.attr("action") === "btn_today") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:1,t:"speed"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var speed_today = {
                            title: "今天加速情况",
                            total_flow:data.data.res_wx.total_flaw,
                            save_flow:data.data.res_wx.save_flaw,
                            percent_flow:data.data.res_wx.percent_flaw,
                            total_req:data.data.res_wx.total_req,
                            save_req:data.data.res_wx.save_req,
                            percent_req:data.data.res_wx.percent_req
                        };
                        var rendered = Mustache.to_html($('#speed_template').html(), speed_today);
                        $('#content_render').html(rendered);
                        charts_show('pie_chart_flow','pie_chart_flow','pie_chart_flow_option','回源流量',speed_today.save_flow,'加速流量',speed_today.total_flow - speed_today.save_flow);
                        charts_show('pie_chart_req','pie_chart_req','pie_chart_req_option','回源请求',speed_today.save_req,'加速请求',speed_today.total_req - speed_today.save_req);
                    }
                });
            }else if(current.attr("action") === "btn_yesterday") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-1,t:"speed"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var speed_yesterday = {
                            title: "昨天加速情况",
                            total_flow:data.data.res_wx.total_flaw,
                            save_flow:data.data.res_wx.save_flaw,
                            percent_flow:data.data.res_wx.percent_flaw,
                            total_req:data.data.res_wx.total_req,
                            save_req:data.data.res_wx.save_req,
                            percent_req:data.data.res_wx.percent_req
                        };
                        var rendered = Mustache.to_html($('#speed_template').html(), speed_yesterday);
                        $('#content_render').html(rendered);
                        charts_show('pie_chart_flow','pie_chart_flow','pie_chart_flow_option','回源流量',speed_yesterday.save_flow,'加速流量',speed_yesterday.total_flow - speed_yesterday.save_flow);
                        charts_show('pie_chart_req','pie_chart_req','pie_chart_req_option','回源请求',speed_yesterday.save_req,'加速请求',speed_yesterday.total_req - speed_yesterday.save_req);
                    }
                });
            }else if(current.attr("action") === "btn_seven") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-3,t:"speed"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var speed_seven = {
                            title: "7天加速情况",
                            total_flow:data.data.res_wx.total_flaw,
                            save_flow:data.data.res_wx.save_flaw,
                            percent_flow:data.data.res_wx.percent_flaw,
                            total_req:data.data.res_wx.total_req,
                            save_req:data.data.res_wx.save_req,
                            percent_req:data.data.res_wx.percent_req
                        };
                        var rendered = Mustache.to_html($('#speed_template').html(), speed_seven);
                        $('#content_render').html(rendered);
                        charts_show('pie_chart_flow','pie_chart_flow','pie_chart_flow_option','回源流量',speed_seven.save_flow,'加速流量',speed_seven.total_flow - speed_seven.save_flow);
                        charts_show('pie_chart_req','pie_chart_req','pie_chart_req_option','回源请求',speed_seven.save_req,'加速请求',speed_seven.total_req - speed_seven.save_req);
                    }
                });
            }
        });

        //DDoS攻击接口调用和模板渲染
        $('#ddos td').on('click',function(e){
            var current = $(e.currentTarget);
            if(current.attr("action") === "btn_today") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:1,t:"olddos",data_info:"getMaxDdosByType"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        var ddos_today = {
                            title: "今天DDoS攻击情况",
                            top_flow:data.data.max_trafficin,
                            time:data.data.attack_time
                        };
                        var rendered = Mustache.to_html($('#ddos_template').html(), ddos_today);
                        $('#content_render').html(rendered);
                    }
                });

                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:1,t:"olddos",data_info:"getTopDdosType"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        var ddos_today = {
                            top6_type:[{one:data.data[0],two:data.data[1],three:data.data[2],four:data.data[3],five:data.data[4],six:data.data[5]}]
                        };
                        var rendered = Mustache.to_html($('#ddos_template').html(), ddos_today);
                        $('#content_render').html(rendered);
                    }
                });

                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:1,t:"olddos",data_info:"getTopDdosIp"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var dataFormat = data.data;
                        var res = [];
                        var each = {
                        };
                        $.each(dataFormat, function (i, v) {
                            var index = parseInt(i/2);
                            var value = v._id + "(" + v.src_city + ")";
                            if(i%2){
                                each.second = value;
                                res[index] = each;
                                each = null;
                            }else{
                                each = {
                                    'first': "",
                                    'second': ""
                                };
                                each.first = value;
                            }
                        });
                        var ddos_today = {
                            top10_ip:res
                        };
                        var rendered = Mustache.to_html($('#ddos_template').html(), ddos_today);
                        $('#content_render').html(rendered);
                    }
                });
            }else if(current.attr("action") === "btn_yesterday") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-1,t:"olddos",data_info:"getMaxDdosByType"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        var ddos_yesterday = {
                            title: "昨天DDoS攻击情况",
                            top_flow:data.data.max_trafficin,
                            time:data.data.attack_time
                        };
                        var rendered = Mustache.to_html($('#ddos_template').html(), ddos_yesterday);
                        $('#content_render').html(rendered);
                    }
                });

                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-1,t:"olddos",data_info:"getTopDdosType"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        var ddos_yesterday = {
                            top6_type:[{one:data.data[0],two:data.data[1],three:data.data[2],four:data.data[3],five:data.data[4],six:data.data[5]}]
                        };
                        var rendered = Mustache.to_html($('#ddos_template').html(), ddos_yesterday);
                        $('#content_render').html(rendered);
                    }
                });

                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-1,t:"olddos",data_info:"getTopDdosIp"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var dataFormat = data.data;
                        var res = [];
                        var each = {
                        };
                        $.each(dataFormat, function (i, v) {
                            var index = parseInt(i/2);
                            var value = v._id + "(" + v.src_city + ")";
                            if(i%2){
                                each.second = value;
                                res[index] = each;
                                each = null;
                            }else{
                                each = {
                                    'first': "",
                                    'second': ""
                                };
                                each.first = value;
                            }
                        });
                        var ddos_yesterday = {
                            top10_ip:res
                        };
                        var rendered = Mustache.to_html($('#ddos_template').html(), ddos_yesterday);
                        $('#content_render').html(rendered);
                    }
                });
            }else if(current.attr("action") === "btn_seven") {
                $('#toast').css('display','block');
                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-3,t:"olddos",data_info:"getMaxDdosByType"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        var ddos_seven = {
                            title: "7天DDoS攻击情况",
                            top_flow:data.data.max_trafficin,
                            time:data.data.attack_time
                        };
                        var rendered = Mustache.to_html($('#ddos_template').html(), ddos_seven);
                        $('#content_render').html(rendered);
                    }
                });

                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-3,t:"olddos",data_info:"getTopDdosType"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        var ddos_seven = {
                            top6_type:[{one:data.data[0],two:data.data[1],three:data.data[2],four:data.data[3],five:data.data[4],six:data.data[5]}]
                        };
                        var rendered = Mustache.to_html($('#ddos_template').html(), ddos_seven);
                        $('#content_render').html(rendered);
                    }
                });

                $.ajax({
                    type:"POST",
                    data:{userID:userid,l:"reportsummary",days:-3,t:"olddos",data_info:"getTopDdosIp"},
                    url:'/dashboard/report/'+ id,
                    dataType:'json',
                    success:function(data){
                        $('#toast').css('display','none');
                        var dataFormat = data.data;
                        var res = [];
                        var each = {
                        };
                        $.each(dataFormat, function (i, v) {
                            var index = parseInt(i/2);
                            var value = v._id + "(" + v.src_city + ")";
                            if(i%2){
                                each.second = value;
                                res[index] = each;
                                each = null;
                            }else{
                                each = {
                                    'first': "",
                                    'second': ""
                                };
                                each.first = value;
                            }
                        });
                        var ddos_seven = {
                            top10_ip:res
                        };
                        var rendered = Mustache.to_html($('#ddos_template').html(), ddos_seven);
                        $('#content_render').html(rendered);
                    }
                });
            }
        });

    });

    //按钮方法
    var btn_show = function(dom_id,first_dom,second_dom,third_dom){
        $(dom_id + '_btn').on('click',function(e){
            var status = $(dom_id).css('display');
            if(status === 'none'){
                $(first_dom).css('display','none');
                $(second_dom).css('display','none');
                $(third_dom).css('display','none');
                $(dom_id).css('display','table');
                status = 'table';
            }else{
                $(dom_id).css('display','none');
                status = 'none';
            }
            e.stopPropagation();
        });
    };

    //得到时间方法
    var getTime = function getNowFormatDate(day) {
        if(day === 'now') {
            var n_date = new Date();
            var n_month = n_date.getMonth() + 1;
            var n_day = n_date.getDate();
            var n_hour = n_date.getHours();
            var n_minute = n_date.getMinutes();
            var n_seconds = n_date.getSeconds();
            if (n_month >= 1 && n_month <= 9) {
                n_month = "0" + n_month;
            }
            if (n_day >= 0 && n_day <= 9) {
                n_day = "0" + n_day;
            }
            if (n_hour >= 0 && n_hour <= 9) {
                n_hour = "0" + n_hour;
            }
            if (n_minute >= 0 && n_minute <= 9) {
                n_minute = "0" + n_minute;
            }
            if (n_seconds >= 0 && n_seconds <= 9) {
                n_seconds = "0" + n_seconds;
            }
            var n_time = n_date.getFullYear() + "-" + n_month + "-" + n_day + " " + n_hour + ":" + n_minute + ":" + n_seconds;
            return n_time;

        }else if(day === 'sevenStart') {
            var s_now = new Date();
            var s_date = new Date(s_now.getTime() - 7 * 24 * 3600 * 1000);
            var s_month = s_date.getMonth() + 1;
            var s_day = s_date.getDate();
            if (s_month >= 1 && s_month <= 9) {
                s_month = "0" + s_month;
            }
            if (s_day >= 0 && s_day <= 9) {
                s_day = "0" + s_day;
            }
            var s_time = s_date.getFullYear() + '-' + s_month + '-' + s_day  + ' ' + '00:00:00';
            return s_time;

        }else if(day === 'yesterday') {
            var y_now = new Date();
            var y_date = new Date(y_now.getTime() - 1 * 24 * 3600 * 1000);
            var y_month = y_date.getMonth() + 1;
            var y_day = y_date.getDate();
            if (y_month >= 1 && y_month <= 9) {
                y_month = "0" + y_month;
            }
            if (y_day >= 0 && y_day <= 9) {
                y_day = "0" + y_day;
            }
            var y_time = y_date.getFullYear() + '-' + y_month + '-' + y_day  + ' ' + '00:00:00';
            return y_time;

        }else if(day === 'end') {
            var e_date = new Date();
            var e_month = e_date.getMonth() + 1;
            var e_day = e_date.getDate();
            if (e_month >= 1 && e_month <= 9) {
                e_month = "0" + e_month;
            }
            if (e_day >= 0 && e_day <= 9) {
                e_day = "0" + e_day;
            }
            var e_time = e_date.getFullYear() + '-' + e_month + '-' + e_day  + ' ' + '00:00:00';
            return e_time;

        }
    };

    //图表渲染方法
    var charts_show = function (dom_id,chart_name,chart_name_option,data_name_first,data_first,data_name_second,data_second) {
        require.config({
            paths: {
                echarts: '/static/echarts-2.2.4/dist'
            }
        });
        require(
                [
                    'echarts',
                    'echarts/chart/pie'
                ],
                function (ec) {
                    var chart_name = ec.init(document.getElementById(dom_id));
                    var chart_name_option = {
                        tooltip : {
                            trigger: 'item',
                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                        },
                        legend: {
                            orient : 'horizontal',
                            x : 'center',
                            data:[data_name_first,data_name_second]
                        },
                        calculable : true,
                        series : [
                            {
                                name:'加速情况',
                                type:'pie',
                                radius : ['50%', '70%'],
                                itemStyle : {
                                    normal : {
                                        label : {
                                            show : false
                                        },
                                        labelLine : {
                                            show : false
                                        }
                                    },
                                    emphasis : {
                                        label : {
                                            show : true,
                                            position : 'center',
                                            textStyle : {
                                                fontSize : '30',
                                                fontWeight : 'bold'
                                            }
                                        }
                                    }
                                },
                                data:[
                                    {value:data_second, name:data_name_second},
                                    {value:data_first, name:data_name_first}
                                ]
                            }
                        ]
                    };
                    chart_name.setOption(chart_name_option);
                }
        );
    };

</script>
</html>